<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LT4TGGE596"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-LT4TGGE596');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RunWeather</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- App Logic (ES Module) -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Cache Busting: increment v=ID on deploy -->
    <script type="module" src="src/main.js?v=1.0.25"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts (Async is fine, keeps text visible) -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Sora:wght@500;600;700;800&display=swap"
        rel="stylesheet" media="print" onload="this.media='all'">
    <noscript>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Sora:wght@500;600;700;800&display=swap"
            rel="stylesheet">
    </noscript>

    <!-- CSS (Blocking to prevent FOUC / White Screen) -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Tab Navigation -->
    <div id="view-weather" class="main-view active">
        <div class="tab-nav" role="tablist">
            <button class="tab-btn active" data-action="tab" data-tab="calculator" role="tab"
                aria-selected="true">Calculator</button>
            <button class="tab-btn" data-action="tab" data-tab="current" role="tab" aria-selected="false"
                tabindex="-1">Conditions</button>
            <button class="tab-btn" data-action="tab" data-tab="forecast16" role="tab" aria-selected="false"
                tabindex="-1">Forecast</button>
            <button class="tab-btn" data-action="tab" data-tab="climate" role="tab" aria-selected="false"
                tabindex="-1">Climate</button>
        </div>

        <!-- TAB: CALCULATOR -->
        <div id="tab-calculator" class="tab-content active container container-narrow" role="tabpanel"
            aria-hidden="false">
            <div class="header">
                <div class="header-left">
                    <h1>Calculator</h1>
                    <div class="subtitle flex-center">
                        NSA
                        <span data-action="info-tooltip" data-title="Norwegian Singles Approach"
                            data-text="Structured running method emphasizing three weekly sub-threshold sessions plus easy volume to maximize sustainable aerobic load and long-term progression. Developed by &lt;a href=&quot;https://mybook.to/XzwWbK3&quot; target=&quot;_blank&quot;&gt;James Copeland&lt;/a&gt;."
                            class="fav-star-btn info-tooltip-trigger info-tooltip-trigger--inline">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                        </span>
                    </div>
                </div>
                <button id="btn-settings" class="icon-btn settings-inline-btn" title="Runner Settings (Weight)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>

                <button class="copy-btn" id="copy-btn" title="Copy results to clipboard" aria-label="Copy Results">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>

                <!-- Location Group -->
                <div class="location-group">
                    <div class="location-search-btn">
                        <!-- Star Button -->
                        <button data-action="toggle-favorite" class="icon-btn btn-favorite location-search-icon"
                            title="Toggle Favorite">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                </polygon>
                            </svg>
                        </button>

                        <!-- Location Dropdown Trigger -->
                        <button class="location-btn location-name-btn" data-action="toggle-dropdown"
                            aria-label="Change Location">
                            <div class="loc-text-col text-left">
                                <span class="current-location-name">Florianópolis</span>
                                <span class="elevation-display location-subtitle">--m</span>
                            </div>
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" class="location-chevron">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>

                    <!-- Dropdown Menu -->
                    <div class="dropdown-menu dropdown-menu-right">
                        <!-- JS Injected Content -->
                    </div>
                </div>
            </div>

            <div class="input-section input-section-flat">
                <!-- Time Trial Block -->
                <div class="modern-input-card card-glow-border">
                    <div class="modern-label">
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Time Trial
                    </div>
                    <div class="input-row-grid">
                        <div class="floating-input-group">
                            <label for="dist-preset">Preset</label>
                            <select id="dist-preset" class="modern-input">
                                <option value="custom">Custom</option>
                                <option value="3000">3000m</option>
                                <option value="5000">5K</option>
                                <option value="10000">10K</option>
                                <option value="21097">Half Mar.</option>
                                <option value="42195">Marathon</option>
                            </select>
                        </div>
                        <div class="floating-input-group">
                            <label for="distance">Distance (m)</label>
                            <input type="number" id="distance" value="2955" placeholder="e.g. 5000" class="modern-input"
                                inputmode="decimal">
                        </div>
                        <div class="floating-input-group">
                            <label for="time">Time (MM:SS)</label>
                            <input type="text" id="time" value="11:16" placeholder="MM:SS" class="modern-input"
                                inputmode="numeric">
                        </div>
                        <div class="floating-input-group">
                            <label for="input-pace" id="label-input-pace">Pace (/km)</label>
                            <input type="text" id="input-pace" placeholder="MM:SS" class="modern-input"
                                inputmode="numeric">
                        </div>
                    </div>
                </div>

                <!-- VDOT Card -->
                <div class="vdot-box" id="vdot-card">
                    <div class="vdot-header flex-between" data-action="vdot-details" role="button" tabindex="0"
                        aria-expanded="false" aria-controls="vdot-details">
                        <div class="vdot-info">
                            <div class="vdot-label">Estimated VDOT <span class="vdot-hint">(Click to Expand)</span>
                            </div>
                            <div class="vdot-sub">Based on 5k: <span id="pred-5k" class="vdot-highlight">--:--</span>
                            </div>
                            <div class="vdot-sub vdot-sub-gap">Threshold: <span id="vdot-threshold"
                                    class="vdot-highlight vdot-bold">--:--/km</span></div>
                        </div>
                        <div class="vdot-right">
                            <!-- SVG Gauge -->
                            <div class="vdot-gauge" id="vdot-gauge">
                                <svg viewBox="0 0 120 70" class="vdot-gauge-svg">
                                    <!-- Background arc (track) -->
                                    <path class="vdot-gauge-track" d="M 10 65 A 50 50 0 0 1 110 65" />
                                    <!-- Foreground arc (progress) -->
                                    <path class="vdot-gauge-arc" id="vdot-gauge-arc" d="M 10 65 A 50 50 0 0 1 110 65" />
                                </svg>
                                <div class="vdot-gauge-value text-gradient-primary" id="vdot-val">--</div>
                                <div class="vdot-gauge-label" id="vdot-gauge-label"></div>
                            </div>
                        </div>
                    </div>
                    <div id="vdot-details" class="vdot-details-panel">
                        <!-- Detailed Rows will be injected here -->
                    </div>
                </div>

                <!-- Weather Block (Moved Down) -->
                <div class="modern-input-card card-glow-border">
                    <div class="modern-label">
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M17 16.974c4.375-1.074 4.375-7.79 0-8.863C15.875 3.097 9.125 3.097 8 8.11 3.625 9.184 3.625 15.9 8 16.974h9z">
                            </path>
                        </svg>
                        Weather Conditions
                    </div>
                    <div class="input-row-grid cols-3">
                        <div class="floating-input-group">
                            <label for="temp" id="label-temp">Temperature (°C)</label>
                            <input type="number" id="temp" placeholder="Temp" title="Temperature in Celsius"
                                inputmode="decimal" class="modern-input">
                        </div>
                        <div class="floating-input-group">
                            <label for="dew" id="label-dew">Dew Point (°C)</label>
                            <input type="number" id="dew" placeholder="Dew" title="Dew Point in Celsius"
                                inputmode="decimal" class="modern-input">
                        </div>
                        <div class="floating-input-group">
                            <label for="wind" id="label-wind">Wind Speed (km/h)</label>
                            <input type="number" id="wind" placeholder="Wind" title="Wind Speed in km/h"
                                inputmode="decimal" class="modern-input">
                        </div>
                    </div>

                    <div class="impact-grid impact-grid--controls">
                        <div id="weather-impact" class="impact-box clickable-card" data-toggle-target="heat"
                            role="button" tabindex="0">
                            <!-- Content injected via JS -->
                        </div>
                        <div id="wind-impact" class="impact-box clickable-card" data-toggle-target="wind" role="button"
                            tabindex="0">
                            <!-- Content injected via JS -->
                        </div>
                        <div id="altitude-impact-card" class="impact-box clickable-card" data-toggle-target="altitude"
                            role="button" tabindex="0" style="display:none;">
                            <!-- Content injected via JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- View Model Toggles Removed -->
            <!-- Interaction moved to Impact Cards -->

            <div class="card">
                <div class="card-title">
                    Subthreshold
                </div>

                <div class="data-row">
                    <div class="data-label-group">
                        <div class="split-badge">
                            <span class="sb-time">1 min</span>
                            <span class="sb-sep"></span>
                            <span class="sb-tag tag-10kp-text">10KP</span>
                        </div>
                    </div>
                    <div class="data-value-group">
                        <div class="data-value" id="pace-1min">--:--/km</div>
                        <div class="data-sub" id="dist-1min">-- m</div>
                    </div>
                </div>

                <div class="data-row">
                    <div class="data-label-group">
                        <div class="split-badge">
                            <span class="sb-time">3 min</span>
                            <span class="sb-sep"></span>
                            <span class="sb-tag tag-15kp-text">15KP</span>
                        </div>
                    </div>
                    <div class="data-value-group">
                        <div class="data-value" id="pace-3min">--:--/km</div>
                        <div class="data-sub" id="dist-3min">-- m</div>
                    </div>
                </div>

                <div class="data-row">
                    <div class="data-label-group">
                        <div class="split-badge">
                            <span class="sb-time">6 min</span>
                            <span class="sb-sep"></span>
                            <span class="sb-tag tag-hmp-text">HMP</span>
                        </div>
                    </div>
                    <div class="data-value-group">
                        <div class="data-value" id="pace-6min">--:--/km</div>
                        <div class="data-sub" id="dist-6min">-- m</div>
                    </div>
                </div>

                <div class="data-row">
                    <div class="data-label-group">
                        <div class="split-badge">
                            <span class="sb-time">10 min</span>
                            <span class="sb-sep"></span>
                            <span class="sb-tag tag-30kp-text">30KP</span>
                        </div>
                    </div>
                    <div class="data-value-group">
                        <div class="data-value" id="pace-10min">--:--/km</div>
                        <div class="data-sub" id="dist-10min">-- m</div>
                    </div>
                </div>
            </div>

            <div class="card card-spaced-top">
                <div class="card-title">
                    Easy Run
                </div>
                <div class="data-row">
                    <div class="data-label-group">
                        <div class="split-badge">
                            <span class="sb-time">Easy Run</span>
                            <span class="sb-sep"></span>
                            <span class="sb-tag tag-ez-text">EZ</span>
                        </div>
                    </div>
                    <div class="data-value-group">
                        <div class="data-value" id="pace-easy">--:--/km</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: CURRENT -->
        <div id="tab-current" class="tab-content container container-narrow" role="tabpanel" aria-hidden="true" hidden>
            <div class="header">
                <div class="header-left">
                    <h1>Conditions</h1>
                    <div class="subtitle flex-center">
                        Real-time Weather
                        <span data-action="info-tooltip" data-title="" data-text="Weather data provided by Open-Meteo."
                            class="fav-star-btn info-tooltip-trigger info-tooltip-trigger--inline">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                        </span>
                    </div>
                </div>

                <button class="copy-btn" id="btn-copy-cond" data-action="copy-conditions"
                    title="Copy conditions to clipboard" aria-label="Copy Conditions">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>

                <!-- Location Group -->
                <div class="location-group">
                    <div class="location-search-btn">
                        <!-- Star Button -->
                        <button data-action="toggle-favorite" class="icon-btn btn-favorite location-search-icon"
                            title="Toggle Favorite">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                </polygon>
                            </svg>
                        </button>

                        <!-- Location Dropdown Trigger -->
                        <button class="location-btn location-name-btn" data-action="toggle-dropdown"
                            aria-label="Change Location">
                            <div class="loc-text-col text-left">
                                <span class="current-location-name">Florianópolis</span>
                                <span class="elevation-display location-subtitle">--m</span>
                            </div>
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" class="location-chevron">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>

                    <!-- Dropdown Menu -->
                    <div class="dropdown-menu dropdown-menu-right">
                        <!-- JS Injected Content -->
                    </div>
                </div>


            </div>
            <div id="current-content" class="current-grid">
                <div class="loading-state loading-state--card">
                    <svg class="animate-spin loading-spinner"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <div class="loading-state-label">Loading Weather...</div>
                </div>
            </div>
        </div>
        <!-- TAB: FORECAST 16 DAYS -->
        <div id="tab-forecast16" class="tab-content container container-narrow" role="tabpanel" aria-hidden="true"
            hidden>
            <div class="header">
                <div class="header-left">
                    <h1>Forecast</h1>
                    <div class="subtitle">14-Day Heat Impact</div>
                </div>
                <!-- Location Group -->
                <div class="location-group">
                    <div class="location-search-btn">
                        <!-- Star Button -->
                        <button data-action="toggle-favorite" class="icon-btn btn-favorite location-search-icon"
                            title="Toggle Favorite">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                </polygon>
                            </svg>
                        </button>

                        <!-- Location Dropdown Trigger -->
                        <button class="location-btn location-name-btn" data-action="toggle-dropdown"
                            aria-label="Change Location">
                            <div class="loc-text-col text-left">
                                <span class="current-location-name">Florianópolis</span>
                                <span class="elevation-display location-subtitle">--m</span>
                            </div>
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" class="location-chevron">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>

                    <!-- Dropdown Menu -->
                    <div class="dropdown-menu dropdown-menu-right">
                        <!-- JS Injected Content -->
                    </div>
                </div>
            </div>

            <!-- Best Run Time Banner (Minimal) -->
            <div id="best-run-banner" class="insight-banner" style="display:none;">
                <div class="insight-left">
                    <span class="insight-title">Best Window</span>
                    <div class="insight-selector">
                        <span class="insight-btn active" data-action="insight-range" data-range="24h">24h</span>
                        <span class="insight-btn" data-action="insight-range" data-range="7d">7d</span>
                        <span class="insight-btn" data-action="insight-range" data-range="14d">14d</span>
                    </div>
                </div>
                <div class="insight-right">
                    <span class="insight-val" id="best-run-val">--:--</span>
                    <span id="best-run-impact" class="insight-impact">--%</span>
                </div>
            </div>

            <!-- Weekly Heatmap -->
            <div class="forecast-card">
                <h3 class="h3-title">
                    Forecast Heatmap</h3>
                <div class="scroll-x-auto">
                    <div id="forecast-grid-container-16" class="forecast-grid">
                        <!-- JS Injected -->
                    </div>
                </div>
                <!-- Legend -->
                <div class="legend-container heatmap-legend" id="legend-container-16">
                    <!-- JS Injected -->
                </div>
            </div>

            <!-- Trend Chart -->
            <div class="forecast-card">
                <div data-action="toggle-temp-chart" class="chart-toggle-header">
                    <h3 class="h3-title table-heading-no-margin">
                        Temperature & Dew Point</h3>
                    <span id="temp-toggle-icon" class="chart-toggle-icon">▼</span>
                </div>

                <div id="temp-chart-wrapper" class="chart-wrapper">
                    <div id="forecast-chart-container-16" class="chart-box">
                        <!-- JS Injected SVG -->
                        <div class="chart-placeholder">
                            Loading
                            Chart...</div>
                    </div>
                    <div class="chart-legend">
                        <div class="chart-legend-item chart-legend-item--temp"><span
                                class="chart-legend-dot chart-legend-dot--temp"></span> Temp</div>
                        <div class="chart-legend-item chart-legend-item--dew"><span
                                class="chart-legend-dot chart-legend-dot--dew"></span> Dew Point
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rain Chart -->
            <div class="forecast-card">
                <div data-action="toggle-rain-chart" class="chart-toggle-header">
                    <h3 class="h3-title table-heading-no-margin">
                        Precipitation</h3>
                    <span id="rain-toggle-icon" class="chart-toggle-icon">▼</span>
                </div>

                <div id="rain-chart-wrapper" class="chart-wrapper">
                    <div id="forecast-rain-chart-container-16" class="chart-box">
                        <!-- JS Injected SVG -->
                        <div class="chart-placeholder">
                            Loading
                            Chart...</div>
                    </div>
                    <div class="chart-legend">
                        <div class="chart-legend-item chart-legend-item--rain"><span
                                class="chart-legend-dot chart-legend-dot--rain"></span> <span id="legend-rain-label">Rain (mm)</span></div>
                        <div class="chart-legend-item chart-legend-item--prob"><span
                                class="chart-legend-line chart-legend-line--prob"></span> Probability (%)</div>
                    </div>
                </div>
            </div>

            <!-- Wind Chart -->
            <div class="forecast-card">
                <div data-action="toggle-wind-chart" class="chart-toggle-header">
                    <h3 class="h3-title table-heading-no-margin">
                        Wind Speed</h3>
                    <span id="wind-toggle-icon" class="chart-toggle-icon">▼</span>
                </div>

                <div id="wind-chart-wrapper" class="chart-wrapper">
                    <div id="forecast-wind-chart-container-16" class="chart-box">
                        <!-- JS Injected SVG -->
                        <div class="chart-placeholder">
                            Loading
                            Chart...</div>
                    </div>
                    <div class="chart-legend">
                        <div class="chart-legend-item chart-legend-item--wind"><span
                                class="chart-legend-line chart-legend-line--wind"></span> <span id="legend-wind-label">Wind (km/h)</span></div>
                    </div>
                </div>
            </div>

            <!-- Pace Selector (Shared State) -->
            <div class="pace-mode-row">
                <span class="pace-mode-label">Adjust Paces For:</span>
                <div id="pace-tag-container-16" class="pace-mode-tags">
                    <button class="tag-btn tag-10kp" data-action="pace-mode" data-mode="10KP">10KP</button>
                    <button class="tag-btn tag-15kp" data-action="pace-mode" data-mode="15KP">15KP</button>
                    <button class="tag-btn tag-hmp active" data-action="pace-mode" data-mode="HMP">HMP</button>
                    <button class="tag-btn tag-30kp" data-action="pace-mode" data-mode="30KP">30KP</button>
                    <button class="tag-btn tag-ez" data-action="pace-mode" data-mode="EZ">EZ</button>
                </div>
            </div>

            <div class="table-wrapper">
                <table class="forecast-table">
                    <thead>
                        <tr>
                            <th data-action="sort-forecast" data-col="time" class="th-sort">Time</th>
                            <th data-action="sort-forecast" data-col="temp" class="th-sort th-sort-center">
                                Temp
                            </th>
                            <th data-action="sort-forecast" data-col="dew" class="th-sort th-sort-center">Dew
                            </th>
                            <th data-action="sort-forecast" data-col="rain" class="th-sort th-sort-center th-sort-rain">
                                Rain/Prob</th>

                            <th data-action="sort-forecast" data-col="wind" class="th-sort th-sort-center th-sort-wind">
                                Wind</th>
                            <th data-action="sort-forecast" data-col="impact" class="th-sort th-sort-center">
                                Impact
                            </th>

                        </tr>
                    </thead>
                    <tbody id="forecast-body-16">
                        <tr>
                            <td colspan="5" class="table-loading-cell">Loading forecast...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Climate Tab -->
        <div id="tab-climate" class="tab-content container container-narrow" role="tabpanel" aria-hidden="true" hidden>
            <div class="header">
                <div class="header-left">
                    <h1>Climate Analysis</h1>
                    <div class="subtitle flex-center">
                        Historical Trends
                        <span data-action="info-tooltip" data-title=""
                            data-text="Analysis based on the last 6 years of historical weather data from Open-Meteo."
                            class="fav-star-btn info-tooltip-trigger info-tooltip-trigger--inline">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                        </span>
                    </div>
                </div>
                <!-- Location Group -->
                <div class="location-group">
                    <div class="location-search-btn">
                        <!-- Star Button -->
                        <button data-action="toggle-favorite" class="icon-btn btn-favorite location-search-icon"
                            title="Toggle Favorite">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                </polygon>
                            </svg>
                        </button>

                        <!-- Location Dropdown Trigger -->
                        <button class="location-btn location-name-btn" data-action="toggle-dropdown"
                            aria-label="Change Location">
                            <div class="loc-text-col text-left">
                                <span class="current-location-name">Florianópolis</span>
                                <span class="elevation-display location-subtitle">--m</span>
                            </div>
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" class="location-chevron">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>

                    <!-- Dropdown Menu -->
                    <div class="dropdown-menu dropdown-menu-right">
                        <!-- JS Injected Content -->
                    </div>
                </div>
            </div>

            <div class="forecast-card climate-overflow-card">
                <h3 class="section-title">
                    Seasonal Heat Impact
                </h3>

                <div>
                    <!-- Static X-Axis Labels removed; now rendered by SVG -->
                    <!-- <div
                    style="display:flex; justify-content:space-between; padding-left:40px; margin-bottom:5px; color:var(--text-secondary); font-size:0.75rem;">
                    <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                    <span>Jul</span><span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span>
                </div> -->

                    <div id="climate-heatmap-shell" class="climate-heatmap-shell">
                        <div id="climate-heatmap-container" class="climate-heatmap-grid">
                            <!-- JS Injected -->
                        </div>
                    </div>

                    <div id="climate-legend-container" class="heatmap-legend">
                        <!-- JS Injected -->
                    </div>
                </div>
            </div>

            <!-- Monthly Averages Card -->
            <div class="forecast-card">
                <div data-action="toggle-monthly" class="chart-toggle-header">
                    <h3 class="section-title section-title--compact">
                        Monthly Averages
                    </h3>
                    <span id="monthly-toggle-icon" class="chart-toggle-icon">▼</span>
                </div>

                <div id="monthly-averages-wrapper" class="monthly-averages-wrapper">
                    <div id="monthly-averages-content" class="monthly-list">
                        <!-- JS Injected Rows -->
                        <div class="table-loading-cell">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="section-row">
                <span class="section-row-title">Historical
                    Data</span>
                <div class="start-center gap-2">
                    <span id="climate-filter-label" class="filter-pill" style="display:none;"></span>
                    <button id="climate-clear-filter" data-action="filter-climate" class="link-button link-button--small"
                        style="display:none;">Clear</button>
                </div>
            </div>

            <div class="table-wrapper">
                <table class="forecast-table">
                    <thead class="climate-thead">
                        <tr>
                            <th class="th-sort th-sort-time" data-action="sort-climate" data-col="date">Time <span
                                    id="sort-icon-climate-date"></span></th>
                            <th class="th-sort th-sort-center" data-action="sort-climate" data-col="temp">
                                Temp <span id="sort-icon-climate-temp"></span></th>
                            <th class="th-sort th-sort-center" data-action="sort-climate" data-col="dew">Dew
                                <span id="sort-icon-climate-dew"></span>
                            </th>
                            <th class="th-sort th-sort-center" data-action="sort-climate" data-col="precip">
                                Rain <span id="sort-icon-climate-precip"></span></th>
                            <th class="th-sort th-sort-center" data-action="sort-climate" data-col="wind">
                                Wind <span id="sort-icon-climate-wind"></span></th>
                            <th class="th-sort th-sort-center" data-action="sort-climate" data-col="impact">
                                Impact <span id="sort-icon-climate-impact">▼</span></th>
                        </tr>
                    </thead>
                    <tbody id="climateTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="github-footer">
        <a href="https://github.com/rapinoinfeliz/RunWeather/" target="_blank" class="github-link"
            aria-label="View on GitHub">
            <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                <path
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
        </a>
    </div>

    <div id="forecast-tooltip" class="forecast-tooltip" role="dialog" aria-live="polite" aria-hidden="true"></div>
    <!-- Location Modal -->
    <div id="loc-modal" class="modal-backdrop" aria-hidden="true" inert>
        <div class="modal-content premium-modal">
            <div class="modal-header-row">
                <span class="modal-title">Select Location</span>
                <button type="button" id="close-modal" class="close-modal-btn" data-action="location-close"
                    aria-label="Close location modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <button data-action="gps" class="modern-button modal-gps-btn" id="gps-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="22" y1="12" x2="18" y2="12"></line>
                    <line x1="6" y1="12" x2="2" y2="12"></line>
                    <line x1="12" y1="6" x2="12" y2="2"></line>
                    <line x1="12" y1="22" x2="12" y2="18"></line>
                </svg>
                Find my Location
            </button>

            <div class="modal-or">OR</div>

            <div class="search-box">
                <svg class="search-icon" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
                    viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="loc-search" class="search-input" placeholder="Search city..." autocomplete="off">
            </div>

            <div id="loc-results" class="loc-results"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-backdrop" aria-hidden="true" inert>
        <div class="modal-content premium-modal settings-modal-content">
            <div class="modal-header-row settings-modal-header">
                <span class="modal-title">Settings</span>
                <button type="button" id="close-settings" class="close-modal-btn" data-action="settings-close"
                    aria-label="Close settings modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="settings-section-label">Units</div>
            <div class="settings-unit-group" role="radiogroup" aria-label="Unit system">
                <label class="radio-label settings-radio-pill">
                    <input type="radio" name="unit-system" value="metric" checked>
                    <span>Metric</span>
                </label>
                <label class="radio-label settings-radio-pill">
                    <input type="radio" name="unit-system" value="imperial">
                    <span>Imperial</span>
                </label>
            </div>

            <div class="settings-section-label">Body</div>
            <div class="settings-grid-two">
                <div class="settings-col">
                    <label for="runner-weight" class="settings-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
                            <line x1="16" y1="8" x2="2" y2="22"></line>
                            <line x1="17.5" y1="15" x2="9" y2="15"></line>
                        </svg>
                        Weight
                        <span data-action="info-tooltip" data-title="Weight"
                            data-text="Used for wind resistance calculation and weight-based pace projections"
                            class="info-tooltip-trigger info-tooltip-trigger--inline"><svg width="12" height="12"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg></span>
                    </label>
                    <div class="settings-input-wrapper">
                        <input type="number" id="runner-weight" class="settings-input" placeholder="65" step="0.5"
                            inputmode="decimal">
                        <span id="settings-weight-unit" class="unit-suffix">kg</span>
                    </div>
                </div>

                <div class="settings-col">
                    <label for="runner-height" class="settings-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2v20"></path>
                            <path d="M2 12h4"></path>
                            <path d="M18 12h4"></path>
                        </svg>
                        Height
                        <span data-action="info-tooltip" data-title="Height"
                            data-text="Used to estimate minimum healthy weight (BMI 18.5) in VDOT weight projections"
                            class="info-tooltip-trigger info-tooltip-trigger--inline"><svg width="12" height="12"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg></span>
                    </label>
                    <div class="settings-input-wrapper">
                        <input type="number" id="runner-height" class="settings-input" placeholder="175" step="1"
                            min="100" max="230" inputmode="numeric">
                        <span id="settings-height-unit" class="unit-suffix">cm</span>
                    </div>
                </div>
            </div>

            <div class="settings-section-label">Demographics</div>
            <div class="settings-grid-two">
                <div class="settings-col">
                    <label for="runner-gender" class="settings-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4"></path>
                            <path d="M12 8h.01"></path>
                        </svg>
                        Gender
                        <span data-action="info-tooltip" data-title="Gender"
                            data-text="Used for Age-Graded Performance calculations"
                            class="info-tooltip-trigger info-tooltip-trigger--inline"><svg width="12" height="12"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg></span>
                    </label>
                    <div class="settings-input-wrapper">
                        <select id="runner-gender" class="settings-input">
                            <option value="">Select</option>
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                        </select>
                    </div>
                </div>

                <div class="settings-col">
                    <label for="runner-age" class="settings-label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Age
                        <span data-action="info-tooltip" data-title="Age"
                            data-text="Used for Age-Graded Performance calculations"
                            class="info-tooltip-trigger info-tooltip-trigger--inline"><svg width="12" height="12"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg></span>
                    </label>
                    <div class="settings-input-wrapper">
                        <input type="number" id="runner-age" class="settings-input" placeholder="32" step="1" min="5"
                            max="100" inputmode="numeric">
                        <span class="unit-suffix">yrs</span>
                    </div>
                </div>
            </div>

            <div class="settings-section-label">Environment</div>
            <div class="settings-block">
                <label for="base-altitude" class="settings-label">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3v2"></path>
                        <path d="M16 3v2"></path>
                        <path d="M12 3v6"></path>
                        <path d="m17 8-5 5-5-5"></path>
                        <path d="M3 18h18"></path>
                    </svg>
                    Base Altitude
                    <span data-action="info-tooltip" data-title="Base Altitude"
                        data-text="Your acclimatized home altitude. Pace penalty is calculated when running at higher elevations"
                        class="info-tooltip-trigger info-tooltip-trigger--inline"><svg width="12" height="12"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg></span>
                </label>
                <div class="settings-input-wrapper">
                    <input type="number" id="base-altitude" class="settings-input" placeholder="0" step="100"
                        inputmode="numeric" value="0">
                    <span id="settings-altitude-unit" class="unit-suffix">m</span>
                </div>
            </div>

            <div class="settings-hr-hidden" hidden>
                <input type="number" id="runner-hr-max" class="settings-input" placeholder="190" step="1" min="100"
                    max="260" inputmode="numeric">
                <input type="number" id="runner-resting-hr" class="settings-input" placeholder="52" step="1" min="25"
                    max="120" inputmode="numeric">
            </div>

            <button id="save-settings" class="modern-button settings-save-btn">
                Save Changes
            </button>
        </div>
    </div>

    <!-- Floating Refresh Button -->
    <button id="fab-refresh" class="fab-btn" title="Refresh Weather" aria-label="Refresh Weather">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
        </svg>
    </button>
    </div> <!-- End view-weather -->

    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('SW Ready'))
                .catch(err => console.error('SW Fail', err));
        }
    </script>
</body>

</html>
